{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="profile-header">
        <img src="{{ user.avatar_url or '/static/default-avatar.svg' }}"
             alt="å¤´åƒ" class="avatar-large">        <div class="profile-info">
            <h2>{{ user.username }}</h2>
            <div class="user-tags">
                {% for tag in user.tags %}
                    <span class="tag">{{ tag.name }}</span>
                {% endfor %}
            </div>
            {% if user.bio %}
                <p class="user-bio">{{ user.bio }}</p>
            {% endif %}

            <!-- åŸºæœ¬ä¿¡æ¯ï¼šæ€§åˆ«æ€»æ˜¯å¯è§ -->
            {% if user.gender %}
                <p class="user-detail">æ€§åˆ«:
                    {% if user.gender == 'Male' %}
                        ç”·
                    {% elif user.gender == 'Female' %}
                        å¥³
                    {% elif user.gender == 'Other' %}
                        å…¶ä»–
                    {% else %}
                        ä¸æ„¿é€éœ²
                    {% endif %}
                </p>
            {% endif %}

            <!-- è”ç³»æ–¹å¼ï¼šåªæœ‰åœ¨äº’ç›¸å…³æ³¨æˆ–æŸ¥çœ‹è‡ªå·±èµ„æ–™æ—¶æ‰æ˜¾ç¤º -->
            {% if user.id == current_user.id or current_user.is_mutual_following(user) %}
                <div class="contact-info">
                    <h4 class="contact-title">
                        {% if user.id == current_user.id %}
                            æˆ‘çš„è”ç³»æ–¹å¼
                        {% else %}
                            è”ç³»æ–¹å¼ï¼ˆäº’ç›¸å…³æ³¨å¯è§ï¼‰
                        {% endif %}
                    </h4>
                    {% if user.phone %}
                        <p class="user-detail contact-detail">ğŸ“ ç”µè¯: {{ user.phone }}</p>
                    {% endif %}
                    {% if user.qq %}
                        <p class="user-detail contact-detail">ğŸ§ QQ: {{ user.qq }}</p>
                    {% endif %}
                    {% if user.wechat %}
                        <p class="user-detail contact-detail">ğŸ’¬ å¾®ä¿¡: {{ user.wechat }}</p>
                    {% endif %}
                    {% if user.email %}
                        <p class="user-detail contact-detail">ğŸ“§ é‚®ç®±: {{ user.email }}</p>
                    {% endif %}
                    {% if not (user.phone or user.qq or user.wechat or user.email) %}
                        <p class="no-contact">æš‚æœªè®¾ç½®è”ç³»æ–¹å¼</p>
                    {% endif %}
                </div>
            {% elif user.id != current_user.id %}
                <div class="contact-hint">
                    <p class="hint-text">ğŸ’¡ äº’ç›¸å…³æ³¨åå¯æŸ¥çœ‹è”ç³»æ–¹å¼</p>
                </div>
            {% endif %}
<div class="profile-stats">
    <a href="{{ url_for('follow.following', user_id=user.id) }}" class="stat-link">
        <span>å…³æ³¨: {{ user.followed.count() }}</span>
    </a>
    <a href="{{ url_for('follow.followers', user_id=user.id) }}" class="stat-link">
        <span>ç²‰ä¸: {{ user.followers.count() }}</span>
    </a>
</div>

            {% if user.id == current_user.id %}
                <a href="{{ url_for('user.edit_profile') }}" class="btn-primary">ç¼–è¾‘èµ„æ–™</a>
            {% else %}
                <button class="follow-btn" data-user-id="{{ user.id }}">
                    {% if current_user.is_following(user) %}
                        å–æ¶ˆå…³æ³¨
                    {% else %}
                        å…³æ³¨
                    {% endif %}
                </button>
            {% endif %}
        </div>
    </div>
{% if user != current_user %}
    <hr>
    <h4>å‘ {{ user.username }} å‘é€æ¶ˆæ¯</h4>
    <form action="{{ url_for('message.send_message', recipient_username=user.username) }}" method="post">
        <div class="mb-3">
            <textarea name="body" class="form-control" rows="3" placeholder="å¼€å§‹æ–°çš„å¯¹è¯..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">å‘é€æ¶ˆæ¯</button>
    </form>
{% endif %}
    <div class="user-posts">
        <h3>{{ user.username }}çš„åŠ¨æ€</h3>
        {% if posts %}
            {% for post in posts %}
            <div class="post-card">                <div class="post-header">                    <img src="{{ post.author.avatar_url or '/static/default-avatar.svg' }}"
                         alt="å¤´åƒ" class="avatar-medium">
                    <div class="post-info">
                        <h4><a href="{{ url_for('user.profile', user_id=post.author.id) }}" class="username-link">{{ post.author.username }}</a></h4>
                        <p class="post-time">{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                </div>

                <div class="post-content">
                    <p>{{ post.content }}</p>
                    {% if post.image_url %}
                        <img src="{{ post.image_url }}" alt="åŠ¨æ€å›¾ç‰‡" class="post-image">
                    {% endif %}
                </div>

                <div class="post-actions">
                    <button class="like-btn" data-post-id="{{ post.id }}">
                        â¤ï¸ <span class="likes-count">{{ post.likes_count }}</span>
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-posts">æš‚æ— åŠ¨æ€</p>
        {% endif %}
    </div>
</div>

<style>
.profile-header {
    display: flex;
    align-items: center;
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.profile-info {
    margin-left: 30px;
    flex: 1;
}

.profile-info h2 {
    margin-bottom: 15px;
    color: #2c3e50;
}

.profile-stats {
    margin: 15px 0;
}

.profile-stats span {
    margin-right: 20px;
    color: #7f8c8d;
    font-weight: bold;
}

/* è”ç³»æ–¹å¼æ ·å¼ */
.contact-info {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.contact-title {
    margin: 0 0 10px 0;
    color: #2c3e50;
    font-size: 16px;
    font-weight: bold;
}

.contact-detail {
    margin: 8px 0;
    color: #34495e;
    font-size: 14px;
}

.contact-hint {
    margin-top: 20px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
}

.hint-text {
    margin: 0;
    color: #856404;
    font-size: 14px;
    font-style: italic;
}

.no-contact {
    color: #6c757d;
    font-style: italic;
    margin: 0;
}

/* ç”¨æˆ·åé“¾æ¥æ ·å¼ */
.username-link {
    color: #3498db;
    text-decoration: none;
    transition: color 0.3s ease;
}

.username-link:hover {
    color: #2980b9;
    text-decoration: underline;
}

@media (max-width: 768px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
    }

    .profile-info {
        margin-left: 0;
        margin-top: 20px;
    }
}
</style>
{% endblock %}