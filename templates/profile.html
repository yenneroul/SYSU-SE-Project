{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="profile-header">
        <img src="{{ user.avatar_url or '/static/default-avatar.svg' }}"
             alt="头像" class="avatar-large">        <div class="profile-info">
            <h2>{{ user.username }}</h2>
            <div class="user-tags">
                {% for tag in user.tags %}
                    <span class="tag">{{ tag.name }}</span>
                {% endfor %}
            </div>
            {% if user.bio %}
                <p class="user-bio">{{ user.bio }}</p>
            {% endif %}

            <!-- 基本信息：性别总是可见 -->
            {% if user.gender %}
                <p class="user-detail">性别:
                    {% if user.gender == 'Male' %}
                        男
                    {% elif user.gender == 'Female' %}
                        女
                    {% elif user.gender == 'Other' %}
                        其他
                    {% else %}
                        不愿透露
                    {% endif %}
                </p>
            {% endif %}

            <!-- 联系方式：只有在互相关注或查看自己资料时才显示 -->
            {% if user.id == current_user.id or current_user.is_mutual_following(user) %}
                <div class="contact-info">
                    <h4 class="contact-title">
                        {% if user.id == current_user.id %}
                            我的联系方式
                        {% else %}
                            联系方式（互相关注可见）
                        {% endif %}
                    </h4>
                    {% if user.phone %}
                        <p class="user-detail contact-detail">📞 电话: {{ user.phone }}</p>
                    {% endif %}
                    {% if user.qq %}
                        <p class="user-detail contact-detail">🐧 QQ: {{ user.qq }}</p>
                    {% endif %}
                    {% if user.wechat %}
                        <p class="user-detail contact-detail">💬 微信: {{ user.wechat }}</p>
                    {% endif %}
                    {% if user.email %}
                        <p class="user-detail contact-detail">📧 邮箱: {{ user.email }}</p>
                    {% endif %}
                    {% if not (user.phone or user.qq or user.wechat or user.email) %}
                        <p class="no-contact">暂未设置联系方式</p>
                    {% endif %}
                </div>
            {% elif user.id != current_user.id %}
                <div class="contact-hint">
                    <p class="hint-text">💡 互相关注后可查看联系方式</p>
                </div>
            {% endif %}
<div class="profile-stats">
    <a href="{{ url_for('follow.following', user_id=user.id) }}" class="stat-link">
        <span>关注: {{ user.followed.count() }}</span>
    </a>
    <a href="{{ url_for('follow.followers', user_id=user.id) }}" class="stat-link">
        <span>粉丝: {{ user.followers.count() }}</span>
    </a>
</div>

            {% if user.id == current_user.id %}
                <a href="{{ url_for('user.edit_profile') }}" class="btn-primary">编辑资料</a>
            {% else %}
                <button class="follow-btn" data-user-id="{{ user.id }}">
                    {% if current_user.is_following(user) %}
                        取消关注
                    {% else %}
                        关注
                    {% endif %}
                </button>
            {% endif %}
        </div>
    </div>
{% if user != current_user %}
    <hr>
    <h4>向 {{ user.username }} 发送消息</h4>
    <form action="{{ url_for('message.send_message', recipient_username=user.username) }}" method="post">
        <div class="mb-3">
            <textarea name="body" class="form-control" rows="3" placeholder="开始新的对话..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">发送消息</button>
    </form>
{% endif %}
    <div class="user-posts">
        <h3>{{ user.username }}的动态</h3>
        {% if posts %}
            {% for post in posts %}
            <div class="post-card">                <div class="post-header">                    <img src="{{ post.author.avatar_url or '/static/default-avatar.svg' }}"
                         alt="头像" class="avatar-medium">
                    <div class="post-info">
                        <h4><a href="{{ url_for('user.profile', user_id=post.author.id) }}" class="username-link">{{ post.author.username }}</a></h4>
                        <p class="post-time">{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                </div>

                <div class="post-content">
                    <p>{{ post.content }}</p>
                    {% if post.image_url %}
                        <img src="{{ post.image_url }}" alt="动态图片" class="post-image">
                    {% endif %}
                </div>

                <div class="post-actions">
                    <button class="like-btn" data-post-id="{{ post.id }}">
                        ❤️ <span class="likes-count">{{ post.likes_count }}</span>
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-posts">暂无动态</p>
        {% endif %}
    </div>
</div>

<style>
.profile-header {
    display: flex;
    align-items: center;
    background: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.profile-info {
    margin-left: 30px;
    flex: 1;
}

.profile-info h2 {
    margin-bottom: 15px;
    color: #2c3e50;
}

.profile-stats {
    margin: 15px 0;
}

.profile-stats span {
    margin-right: 20px;
    color: #7f8c8d;
    font-weight: bold;
}

/* 联系方式样式 */
.contact-info {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.contact-title {
    margin: 0 0 10px 0;
    color: #2c3e50;
    font-size: 16px;
    font-weight: bold;
}

.contact-detail {
    margin: 8px 0;
    color: #34495e;
    font-size: 14px;
}

.contact-hint {
    margin-top: 20px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
}

.hint-text {
    margin: 0;
    color: #856404;
    font-size: 14px;
    font-style: italic;
}

.no-contact {
    color: #6c757d;
    font-style: italic;
    margin: 0;
}

/* 用户名链接样式 */
.username-link {
    color: #3498db;
    text-decoration: none;
    transition: color 0.3s ease;
}

.username-link:hover {
    color: #2980b9;
    text-decoration: underline;
}

@media (max-width: 768px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
    }

    .profile-info {
        margin-left: 0;
        margin-top: 20px;
    }
}
</style>
{% endblock %}