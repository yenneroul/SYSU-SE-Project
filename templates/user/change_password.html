{% extends "base.html" %}

{% block title %}ä¿®æ”¹å¯†ç {% endblock %}

{% block content %}
<div class="container">
    <div class="change-password-form">
        <h2>ä¿®æ”¹å¯†ç </h2>
        
        <form method="POST" id="changePasswordForm">
            <div class="form-group">
                <label for="current_password">å½“å‰å¯†ç </label>
                <div class="password-input-container">
                    <input type="password" id="current_password" name="current_password" required>
                    <button type="button" class="password-toggle" onclick="togglePassword('current_password')">
                        ğŸ‘ï¸
                    </button>
                </div>
            </div>
              <div class="form-group">
                <label for="new_password">æ–°å¯†ç </label>
                <div class="password-input-container">
                    <input type="password" id="password" name="new_password" required>
                    <button type="button" class="password-toggle" onclick="togglePassword('password')">
                        ğŸ‘ï¸
                    </button>
                </div>
                <!-- å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ -->
                <div class="password-strength-container">
                    <div class="password-strength-bar">
                        <div class="password-strength-progress"></div>
                    </div>
                    <div class="password-strength-text"></div>
                    <div class="password-suggestions"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="confirm_password">ç¡®è®¤æ–°å¯†ç </label>
                <div class="password-input-container">
                    <input type="password" id="confirm_password" name="confirm_password" required>
                    <button type="button" class="password-toggle" onclick="togglePassword('confirm_password')">
                        ğŸ‘ï¸
                    </button>
                </div>
                <div id="password-match-indicator" class="mt-2"></div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
                <a href="{{ url_for('user.security_settings') }}" class="btn btn-secondary">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</div>

<!-- å¼•å…¥å¯†ç å¼ºåº¦æ£€æµ‹æ ·å¼å’Œè„šæœ¬ -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/password-strength.css') }}">
<script src="{{ url_for('static', filename='js/password-strength.js') }}"></script>

<script>
// å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const button = input.nextElementSibling;
    
    if (input.type === 'password') {
        input.type = 'text';
        button.textContent = 'ğŸ™ˆ';
    } else {
        input.type = 'password';
        button.textContent = 'ğŸ‘ï¸';
    }
}

// å¯†ç ç¡®è®¤åŒ¹é…æ£€æŸ¥
document.getElementById('confirm_password').addEventListener('input', function() {
    const newPassword = document.getElementById('password').value;
    const confirmPassword = this.value;
    const indicator = document.getElementById('password-match-indicator');
    
    if (confirmPassword === '') {
        indicator.innerHTML = '';
        return;
    }
    
    if (newPassword === confirmPassword) {
        indicator.innerHTML = '<div class="check-item check-pass">âœ… å¯†ç åŒ¹é…</div>';
    } else {
        indicator.innerHTML = '<div class="check-item check-fail">âŒ å¯†ç ä¸åŒ¹é…</div>';
    }
});

// è¡¨å•æäº¤éªŒè¯
document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
    const newPassword = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (newPassword !== confirmPassword) {
        e.preventDefault();
        alert('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´ï¼Œè¯·æ£€æŸ¥ï¼');
        return false;
    }
    
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šå®¢æˆ·ç«¯éªŒè¯
});

// åˆå§‹åŒ–å¯†ç å¼ºåº¦æ£€æµ‹å™¨
document.addEventListener('DOMContentLoaded', function() {
    // ä¸ºæ–°å¯†ç è¾“å…¥æ¡†åˆå§‹åŒ–å¼ºåº¦æ£€æµ‹
    new PasswordStrengthChecker({
        passwordInput: '#password',
        realTimeCheck: true,
        showSuggestions: true
    });
});
</script>

<style>
/* é¡µé¢ç‰¹å®šæ ·å¼ */
.container {
    max-width: 600px;
    margin: 50px auto;
    padding: 20px;
}

.password-input-container {
    position: relative;
}

.password-input-container input {
    padding-right: 45px;
}

.password-toggle {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    color: #6c757d;
}

.password-toggle:hover {
    color: #495057;
}

.mt-2 {
    margin-top: 0.5rem;
}
</style>
{% endblock %}
